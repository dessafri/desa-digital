import{_ as ie,g as D,f as _,c as de,o as ue,h as ce,a as r,b as i,d as l,F as $,r as I,e as V,n as f,w as S,v as P,l as pe,A as T,j as me,t as y,y as G,k as g,p as R}from"./app-0010789c.js";import{n as u}from"./notify-9318a045.js";import{c as ge,J as fe,a as be}from"./jodit-11da9fd9.js";const ve={class:"p-8"},xe={class:"mt-8 grid gap-6 lg:grid-cols-[340px_1fr]"},_e={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},ye={class:"mt-4 space-y-2 text-sm"},he=["onClick"],ke={class:"font-semibold"},we={class:"text-xs"},Ae={key:0,class:"text-xs text-slate-400"},Ce={key:0,class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},je={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},Ue={class:"flex gap-2 text-xs font-semibold"},De={class:"mt-6 grid gap-4 md:grid-cols-2 text-sm"},$e={class:"text-xs font-semibold text-slate-500 space-y-1"},Ie={class:"text-xs font-semibold text-slate-500 space-y-1"},Ve={class:"md:col-span-2 text-xs font-semibold text-slate-500 space-y-1"},Se={class:"mt-8 rounded-xl border border-dashed border-slate-300 bg-slate-50 p-4"},Ge={class:"mt-3 grid gap-3 md:grid-cols-[1fr_auto]"},Fe={class:"grid gap-2 text-xs font-semibold text-slate-500"},Oe={class:"space-y-1"},Pe=["value"],Te={class:"space-y-1"},Be={class:"flex items-end gap-2"},Ne=["disabled"],Me=["disabled"],Ee={key:0,class:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6"},Je=["onClick"],He=["src","alt"],Le={class:"p-2 text-[11px] font-semibold text-slate-500 truncate"},Ke={class:"mt-4 space-y-4"},Re=["onDragstart","onDragenter","onDrop"],ze={class:"grid gap-4 md:grid-cols-4 text-xs font-semibold text-slate-500"},qe={class:"space-y-1"},Qe={key:0,class:"overflow-hidden rounded-md border bg-white"},We=["src","onClick"],Xe={key:1,class:"h-20 w-full rounded-md border bg-white grid place-items-center text-slate-400"},Ye={class:"space-y-1 md:col-span-3"},Ze=["onUpdate:modelValue"],et={class:"mt-3 flex justify-between text-xs font-semibold"},tt={class:"text-slate-400"},lt={class:"space-x-3"},st=["onClick"],ot=["onClick"],at={key:0,class:"text-center text-xs text-slate-400"},nt={key:1,class:"rounded-2xl border border-slate-200 bg-white p-10 text-center text-sm text-slate-500"},rt={class:"max-h-[90vh] max-w-5xl overflow-auto rounded-xl bg-white p-3"},it=["src"],dt={__name:"AdminGalleryView",setup(ut){const z=fe,q=be,Q=ge({minHeight:200}),p=D([]),a=_(null),d=D([]),k=_(null),m=D([]),b=D([]),v=_(!1),w=_(""),x=_(null),A=_(null),W=de(()=>{var e;return((e=a.value)==null?void 0:e._key)??null});function B(e){return`${e}-${Math.random().toString(36).slice(2,9)}`}function C(e={},t=[]){return{_key:B(e.id??"new"),id:e.id??null,title:e.title??"",slug:e.slug??"",description:e.description??"",cover_image:e.cover_image??"",items:e.items??t??[]}}function j(e={}){var t;return{_key:B(e.id??"new"),id:e.id??null,gallery_album_id:e.gallery_album_id??((t=a.value)==null?void 0:t.id)??null,title:e.title??"",caption:e.caption??"",image_url:e.image_url??"",order:Number(e.order??0)}}function N(e){var t;return{id:e.id??null,gallery_album_id:((t=a.value)==null?void 0:t.id)??e.gallery_album_id??null,title:e.title??"",caption:e.caption??"",image_url:e.image_url??"",order:Number(e.order??0)}}function h(){a.value&&(a.value.items=d.map(e=>N(e)))}async function M(){const{data:e}=await g.get("/gallery-albums");if(p.splice(0,p.length,...e.map(t=>C(t,t.items??[]))),a.value){const t=p.find(o=>o.id===a.value.id);t?U(t):(a.value=null,d.splice(0,d.length))}}function X(){const e=C();p.unshift(e),U(e)}function U(e){a.value=e,d.splice(0,d.length,...(e.items??[]).map(j)),k.value=e.id??null}async function E(e){const t={title:e.title,slug:e.slug||null,description:e.description||null,cover_image:null};try{if(e.id){const{data:o}=await g.put(`/gallery-albums/${e.id}`,t);Object.assign(e,C({...o,items:e.items})),u.success("Album diperbarui")}else{const{data:o}=await g.post("/gallery-albums",t);Object.assign(e,C({...o,items:[]})),u.success("Album dibuat")}h(),e.id||U(e)}catch(o){console.error(o),u.error("Gagal menyimpan album")}}async function Y(e){var o;if(e.id){if(!confirm(`Hapus album "${e.title||"album"}"?`))return;try{await g.delete(`/gallery-albums/${e.id}`),u.success("Album dihapus")}catch(s){console.error(s),u.error("Gagal menghapus album");return}}const t=p.findIndex(s=>s._key===e._key);t!==-1&&p.splice(t,1),((o=a.value)==null?void 0:o._key)===e._key&&(a.value=null,d.splice(0,d.length))}async function Z(e){var o;(o=a.value)!=null&&o.id||await E(a.value);const t={gallery_album_id:a.value.id,title:e.title||null,caption:e.caption||null,image_url:e.image_url,order:Number(e.order)||0};try{if(e.id){const{data:s}=await g.put(`/gallery-items/${e.id}`,t);Object.assign(e,j({...s})),u.success("Foto diperbarui")}else{const{data:s}=await g.post("/gallery-items",t);Object.assign(e,j({...s})),u.success("Foto ditambahkan")}h()}catch(s){console.error(s),u.error("Gagal menyimpan foto")}}async function ee(e){if(e.id){if(!confirm("Hapus foto ini?"))return;try{await g.delete(`/gallery-items/${e.id}`),u.success("Foto dihapus")}catch(o){console.error(o),u.error("Gagal menghapus foto");return}}const t=d.findIndex(o=>o._key===e._key);t!==-1&&d.splice(t,1),h()}ue(M);function te(e){const t=Array.from(e.target.files||[]);m.splice(0,m.length,...t),b.splice(0,b.length,...t.map(o=>({name:o.name,url:URL.createObjectURL(o)})))}function J(){m.splice(0,m.length),b.forEach(e=>URL.revokeObjectURL(e.url)),b.splice(0,b.length)}async function le(){var o,s;if(!m.length||v.value)return;const e=k.value||((o=a.value)==null?void 0:o.id);if(!e){alert("Pilih album tujuan terlebih dahulu.");return}const t=new FormData;t.append("gallery_album_id",String(e)),m.forEach(n=>t.append("files[]",n)),v.value=!0;try{const{data:n}=await g.post("/gallery-items/upload",t,{headers:{"Content-Type":"multipart/form-data"}}),K=(Array.isArray(n)?n:[]).map(j),F=p.find(O=>O.id===e);F&&(F.items=[...F.items||[],...K.map(O=>N(O))]),((s=a.value)==null?void 0:s.id)===e&&(d.splice(0,0,...K),h()),J(),u.success("Upload selesai")}catch(n){console.error(n),u.error("Upload gagal")}finally{v.value=!1}}function H(e){w.value=e}function L(){w.value=""}function se(e){x.value=e}function oe(e){x.value!==null&&(A.value=e)}async function ae(e){if(x.value===null)return;const t=x.value,o=e;if(t!==o){const[s]=d.splice(t,1);d.splice(o,0,s),d.forEach((n,c)=>n.order=c),await re(),h()}x.value=null,A.value=null}function ne(){x.value=null,A.value=null}async function re(){try{const e=d.filter(t=>t.id).map((t,o)=>g.put(`/gallery-items/${t.id}`,{order:o}));e.length&&(await Promise.all(e),u.success("Urutan tersimpan"))}catch(e){console.error("Gagal menyimpan urutan:",e),u.error("Gagal menyimpan urutan")}}return(e,t)=>{const o=ce("jodit-editor");return r(),i("div",ve,[l("header",{class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},[t[7]||(t[7]=l("div",null,[l("h1",{class:"text-2xl font-semibold text-slate-900"},"Galeri Desa"),l("p",{class:"text-sm text-slate-500"},"Kelola album galeri dan foto dokumentasi kegiatan.")],-1)),l("div",{class:"flex gap-3 text-sm font-semibold"},[l("button",{class:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-slate-600",onClick:M}," Muat Ulang "),l("button",{class:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-white",onClick:X}," Album Baru ")])]),l("section",xe,[l("aside",_e,[t[8]||(t[8]=l("h2",{class:"text-sm font-semibold text-slate-700"},"Album",-1)),l("ul",ye,[(r(!0),i($,null,I(p,s=>{var n;return r(),i("li",{key:s._key,class:R(["cursor-pointer rounded-lg border px-3 py-2 transition",s._key===W.value?"border-primary bg-primary/10 text-primary":"border-slate-200 text-slate-600 hover:border-primary/40"]),onClick:c=>U(s)},[l("p",ke,y(s.title||"Album Baru"),1),l("p",we,y(((n=s.items)==null?void 0:n.length)??0)+" foto",1)],10,he)}),128))]),p.length?V("",!0):(r(),i("p",Ae,"Belum ada album. Tambahkan album baru untuk memulai."))]),a.value?(r(),i("div",Ce,[l("div",je,[t[9]||(t[9]=l("h2",{class:"text-lg font-semibold text-slate-900"},"Detail Album",-1)),l("div",Ue,[l("button",{class:"rounded-full border border-slate-200 px-4 py-1 text-slate-600",onClick:t[0]||(t[0]=s=>E(a.value))}," Simpan Album "),l("button",{class:"rounded-full border border-rose-200 px-4 py-1 text-rose-500",onClick:t[1]||(t[1]=s=>Y(a.value))}," Hapus Album ")])]),l("div",De,[l("label",$e,[t[10]||(t[10]=f(" Judul Album ",-1)),S(l("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.title=s),type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2"},null,512),[[P,a.value.title]])]),l("label",Ie,[t[11]||(t[11]=f(" Slug (opsional) ",-1)),S(l("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.slug=s),type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"otomatis dari judul"},null,512),[[P,a.value.slug]])]),l("label",Ve,[t[12]||(t[12]=f(" Deskripsi ",-1)),pe(o,{jsUrl:T(z),cssUrl:T(q),modelValue:a.value.description,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.description=s),config:T(Q)},null,8,["jsUrl","cssUrl","modelValue","config"])])]),l("div",Se,[t[15]||(t[15]=l("h3",{class:"text-sm font-semibold text-slate-700"},"Upload Kegiatan (Multiple)",-1)),l("div",Ge,[l("div",Fe,[l("label",Oe,[t[13]||(t[13]=f(" Album Tujuan ",-1)),S(l("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>k.value=s),class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},[(r(!0),i($,null,I(p,s=>(r(),i("option",{key:s._key,value:s.id},y(s.title||"(Album Baru)"),9,Pe))),128))],512),[[me,k.value]])]),l("label",Te,[t[14]||(t[14]=f(" Pilih Gambar (bisa banyak) ",-1)),l("input",{type:"file",accept:"image/*",multiple:"",onChange:te,class:"block w-full text-sm"},null,32)])]),l("div",Be,[l("button",{class:"rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white disabled:opacity-60",disabled:!m.length||v.value,onClick:le},y(v.value?"Mengunggah...":"Upload Semua"),9,Ne),l("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 disabled:opacity-60",disabled:!m.length||v.value,onClick:J}," Bersihkan ",8,Me)])]),m.length?(r(),i("div",Ee,[(r(!0),i($,null,I(b,(s,n)=>(r(),i("div",{key:n,class:"group cursor-pointer overflow-hidden rounded-lg border bg-white shadow-sm",onClick:c=>H(s.url)},[l("img",{src:s.url,alt:s.name,class:"h-28 w-full object-cover transition group-hover:scale-105"},null,8,He),l("div",Le,y(s.name),1)],8,Je))),128))])):V("",!0)]),t[18]||(t[18]=l("div",{class:"mt-10 flex items-center justify-between"},[l("h3",{class:"text-md font-semibold text-slate-900"},"Foto dalam Album"),l("span",{class:"text-xs text-slate-400"},"Seret kartu untuk mengubah urutan")],-1)),l("div",Ke,[(r(!0),i($,null,I(d,(s,n)=>(r(),i("article",{key:s._key,class:R(["rounded-xl border border-slate-100 bg-slate-50 p-4 transition",n===A.value?"ring-2 ring-primary/40":""]),draggable:"true",onDragstart:c=>se(n),onDragenter:G(c=>oe(n),["prevent"]),onDragover:t[6]||(t[6]=G(()=>{},["prevent"])),onDrop:G(c=>ae(n),["prevent"]),onDragend:ne},[l("div",ze,[l("div",qe,[t[16]||(t[16]=f(" Pratinjau ",-1)),s.image_url?(r(),i("div",Qe,[l("img",{src:s.image_url,class:"h-20 w-full object-cover cursor-pointer",onClick:c=>H(s.image_url)},null,8,We)])):(r(),i("div",Xe,"Tidak ada"))]),l("label",Ye,[t[17]||(t[17]=f(" Caption ",-1)),S(l("input",{"onUpdate:modelValue":c=>s.caption=c,type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},null,8,Ze),[[P,s.caption]])])]),l("div",et,[l("span",tt,y(s.id?"Foto tersimpan":"Foto baru"),1),l("div",lt,[l("button",{class:"text-primary",onClick:c=>Z(s)},"Simpan",8,st),l("button",{class:"text-rose-500",onClick:c=>ee(s)},"Hapus",8,ot)])])],42,Re))),128)),d.length?V("",!0):(r(),i("p",at,"Belum ada foto pada album ini."))])])):(r(),i("div",nt," Pilih album untuk melihat detail. "))]),w.value?(r(),i("div",{key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/70 p-4",onClick:G(L,["self"])},[l("div",rt,[l("img",{src:w.value,alt:"Preview",class:"h-auto w-full"},null,8,it),l("div",{class:"mt-3 text-right"},[l("button",{class:"rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white",onClick:L},"Tutup")])])])):V("",!0)])}}},gt=ie(dt,[["__scopeId","data-v-9014db39"]]);export{gt as default};
