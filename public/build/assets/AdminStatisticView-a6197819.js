import{f as b,c as D,P as w,o as O,O as G,a as o,b as i,d as s,x as I,z as j,t as E,w as U,v as L,F as M,r as z,e as N,i as P,y as V,_ as A,g as K,k as g,p as T,n as B,l as q}from"./app-0010789c.js";import{n as m}from"./notify-9318a045.js";const F={class:"flex items-center gap-2"},H={key:1,class:"text-slate-500"},R={key:0,class:"absolute z-40 mt-1 w-[360px] max-w-[84vw] rounded-xl border border-slate-200 bg-white p-3 shadow-lg"},W={class:"max-h-64 overflow-auto"},J={class:"grid grid-cols-6 gap-2"},Q=["title","onClick"],X={__name:"IconPicker",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Pilih ikon"}},emits:["update:modelValue"],setup($,{emit:x}){const r=$,f=x,d=b(!1),y=b(""),_=b(null),k=D(()=>Object.entries(w).filter(([n])=>n.endsWith("Icon")).map(([n,l])=>({name:n,component:l}))),c=D(()=>{const n=y.value.trim().toLowerCase();return n?k.value.filter(l=>l.name.toLowerCase().includes(n)):k.value}),p=D(()=>{const n=r.modelValue;return n&&w[n]?w[n]:null});function S(){d.value=!d.value}function C(n){f("update:modelValue",n),d.value=!1}O(()=>document.addEventListener("click",h,!0)),G(()=>document.removeEventListener("click",h,!0));function h(n){if(!d.value)return;const l=_.value;l&&!l.contains(n.target)&&(d.value=!1)}return(n,l)=>(o(),i("div",{class:"relative",ref_key:"wrapper",ref:_,onKeydown:l[1]||(l[1]=P(V(e=>d.value=!1,["prevent","stop"]),["escape"]))},[s("button",{type:"button",class:"flex w-full items-center justify-between rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm",onClick:S},[s("span",F,[p.value?(o(),I(j(p.value),{key:0,class:"h-5 w-5 text-slate-600"})):(o(),i("span",H,E($.placeholder),1))]),l[2]||(l[2]=s("svg",{class:"h-4 w-4 text-slate-500",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z","clip-rule":"evenodd"})],-1))]),d.value?(o(),i("div",R,[U(s("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>y.value=e),type:"text",placeholder:"Cari ikon...",class:"mb-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,512),[[L,y.value]]),s("div",W,[s("div",J,[(o(!0),i(M,null,z(c.value,e=>(o(),i("button",{key:e.name,type:"button",class:"group flex items-center justify-center rounded-lg border border-slate-200 p-2 hover:border-primary/50 hover:bg-primary/5",title:e.name.replace("Icon",""),onClick:t=>C(e.name)},[(o(),I(j(e.component),{class:"h-5 w-5 text-slate-700 group-hover:text-primary"}))],8,Q))),128))])])])):N("",!0)],544))}};const Y={class:"p-8"},Z={class:"mt-8 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},ee={key:0,class:"grid place-items-center py-16"},te={key:1,class:"space-y-4"},se=["onDragstart","onDragenter","onDrop"],ae={class:"grid gap-4 md:grid-cols-4"},ne={class:"text-xs font-semibold text-slate-500 space-y-1 md:col-span-2"},le=["onUpdate:modelValue"],oe={class:"text-xs font-semibold text-slate-500 space-y-1"},re=["onUpdate:modelValue"],ie={class:"text-xs font-semibold text-slate-500 space-y-1"},ue={class:"flex items-center justify-between"},de={key:0,class:"inline-flex items-center gap-1 text-[11px] text-slate-400"},ce={class:"mt-4 flex justify-between text-xs font-semibold"},pe={class:"text-slate-400"},me={class:"space-x-3"},fe=["onClick"],ve=["onClick"],be={key:0,class:"text-center text-xs text-slate-400"},xe={__name:"AdminStatisticView",setup($){const x=b(!1),r=K([]);function f(e={}){return{_key:`${e.id??"new"}-${Math.random().toString(36).slice(2,9)}`,id:e.id??null,label:e.label??"",value:Number(e.value??0),icon:e.icon??"",order:Number(e.order??0)}}async function d(){x.value=!0;try{const{data:e}=await g.get("/statistics");r.splice(0,r.length,...e.map(f))}finally{x.value=!1}}function y(){r.unshift(f())}async function _(e){try{const t={label:e.label,value:Number(e.value)||0,icon:e.icon||null};if(e.id){const{data:a}=await g.put(`/statistics/${e.id}`,t);Object.assign(e,f(a)),m.success("Statistik diperbarui")}else{const{data:a}=await g.post("/statistics",t);Object.assign(e,f(a)),m.success("Statistik ditambahkan")}}catch(t){console.error(t),m.error("Gagal menyimpan statistik")}}async function k(e){if(e.id){if(!confirm(`Hapus statistik "${e.label||"statistik"}"?`))return;try{await g.delete(`/statistics/${e.id}`),m.success("Statistik dihapus")}catch(a){console.error(a),m.error("Gagal menghapus statistik");return}}const t=r.findIndex(a=>a._key===e._key);t!==-1&&r.splice(t,1)}O(d);const c=b(null),p=b(null);function S(e){c.value=e}function C(e){c.value!==null&&(p.value=e)}async function h(e){if(c.value===null)return;const t=c.value,a=e;if(t!==a){const[v]=r.splice(t,1);r.splice(a,0,v),await l()}c.value=null,p.value=null}function n(){c.value=null,p.value=null}async function l(){try{const e=r.filter(t=>t.id).map((t,a)=>g.put(`/statistics/${t.id}`,{order:a}));e.length&&(await Promise.all(e),m.success("Urutan statistik tersimpan"))}catch(e){console.error("Gagal menyimpan urutan statistik:",e),m.error("Gagal menyimpan urutan")}}return(e,t)=>(o(),i("div",Y,[s("header",{class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},[t[1]||(t[1]=s("div",null,[s("h1",{class:"text-2xl font-semibold text-slate-900"},"Statistik Desa"),s("p",{class:"text-sm text-slate-500"},"Kelola indikator statistik yang ditampilkan di beranda.")],-1)),s("button",{class:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white",onClick:y}," Tambah Statistik ")]),s("section",Z,[x.value?(o(),i("div",ee,[...t[2]||(t[2]=[s("div",{class:"h-10 w-10 animate-spin rounded-full border-4 border-primary/30 border-t-primary"},null,-1)])])):(o(),i("div",te,[t[6]||(t[6]=s("div",{class:"flex items-center justify-between text-xs text-slate-500"},[s("span",{title:"Seret kartu untuk mengubah urutan"},"Seret kartu untuk mengubah urutan")],-1)),(o(!0),i(M,null,z(r,(a,v)=>(o(),i("article",{key:a._key,class:T(["rounded-xl border border-slate-100 bg-slate-50 p-4 transition",v===p.value?"ring-2 ring-primary/40":""]),draggable:"true",onDragstart:u=>S(v),onDragenter:V(u=>C(v),["prevent"]),onDragover:t[0]||(t[0]=V(()=>{},["prevent"])),onDrop:V(u=>h(v),["prevent"]),onDragend:n},[s("div",ae,[s("label",ne,[t[3]||(t[3]=B(" Label ",-1)),U(s("input",{"onUpdate:modelValue":u=>a.label=u,type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2"},null,8,le),[[L,a.label]])]),s("label",oe,[t[4]||(t[4]=B(" Nilai ",-1)),U(s("input",{"onUpdate:modelValue":u=>a.value=u,type:"number",min:"0",class:"w-full rounded-lg border border-slate-200 px-3 py-2"},null,8,re),[[L,a.value,void 0,{number:!0}]])]),s("div",ie,[s("div",ue,[t[5]||(t[5]=s("span",null,"Ikon",-1)),a.icon?(o(),i("span",de,[(o(),I(j(w[a.icon]),{class:"h-4 w-4"}))])):N("",!0)]),q(X,{modelValue:a.icon,"onUpdate:modelValue":u=>a.icon=u},null,8,["modelValue","onUpdate:modelValue"])])]),s("div",ce,[s("span",pe,E(a.id?"Statistik tersimpan":"Statistik baru"),1),s("div",me,[s("button",{class:"text-primary",onClick:u=>_(a)},"Simpan",8,fe),s("button",{class:"text-rose-500",onClick:u=>k(a)},"Hapus",8,ve)])])],42,se))),128)),r.length?N("",!0):(o(),i("p",be,"Belum ada data statistik."))]))])]))}},_e=A(xe,[["__scopeId","data-v-220f4d14"]]);export{_e as default};
