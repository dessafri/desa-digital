import{N as R,f as g,O as V,c as H,o as P,a as o,b as l,d as a,n as k,F as E,t as p,r as X,k as _,p as K,y as D,e as q}from"./app-0010789c.js";const J={class:"space-y-8 p-8"},Q={class:"space-y-6 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-sm backdrop-blur"},W={key:0,class:"grid place-items-center py-20"},Y={class:"flex items-center justify-between text-xs font-semibold text-slate-400"},Z={key:0,class:"text-primary/70"},ee={key:1,class:"text-emerald-600"},te={key:2},ae={key:0,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},re=["draggable","onDragstart","onDragover","onDragenter","onDragleave","onDrop"],ne={class:"space-y-3"},se={class:"flex items-center justify-between gap-3"},oe={class:"inline-flex h-7 items-center rounded-full bg-primary/10 px-3 text-xs font-semibold text-primary"},le={class:"text-[11px] uppercase tracking-[0.25em] text-slate-400"},ie={class:"text-lg font-semibold text-slate-900 line-clamp-2"},de={key:0,class:"text-sm font-semibold text-primary/70"},ue={class:"text-sm text-slate-500 line-clamp-3"},ce={class:"mt-5 flex items-center justify-between text-xs font-semibold"},pe={class:"text-slate-400"},me={class:"flex items-center gap-4"},fe=["onClick"],ge=["onClick"],ye={key:1,class:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 py-16 text-center"},he={__name:"AdminServiceView",setup(ve){const M=R(),x=g(!1),d=g(!1),v=g(""),i=g([]),m=g(null),f=g(null);let y;V(()=>{y&&clearTimeout(y)});const T=H(()=>i.value);function b(e){y&&clearTimeout(y),v.value=e,e&&(y=setTimeout(()=>{v.value=""},3e3))}function A(e){return e?new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"short",year:"numeric"}).format(new Date(e)):"Baru"}function B(e){const t=[...e].sort((n,c)=>{const u=Number(n.order??Number.MAX_SAFE_INTEGER),S=Number(c.order??Number.MAX_SAFE_INTEGER);if(u!==S)return u-S;const U=n.updated_at?new Date(n.updated_at).getTime():0;return(c.updated_at?new Date(c.updated_at).getTime():0)-U});let r=!1;return{normalized:t.map((n,c)=>{const u=c+1;return Number(n.order??u)!==u&&(r=!0),{...n,order:u}}),changed:r}}async function h(){x.value=!0;try{const{data:e}=await _.get("/services"),{normalized:t,changed:r}=B(e??[]);i.value=t,r&&await j(t,{silent:!0})}finally{x.value=!1}}function C(e){e.forEach((t,r)=>{t.order=r+1})}async function L(e,t){const r=[...i.value];if(e<0||t<0||e===t)return;const[s]=r.splice(e,1);r.splice(t,0,s),C(r),i.value=r,await j(r)}async function j(e,{silent:t=!1}={}){const r=e.filter(s=>s.id);if(r.length){d.value=!0;try{await Promise.all(r.map(async n=>{const c={title:n.title,subtitle:n.subtitle||null,description:n.description||null,icon:n.icon||null,link:n.link||null,order:n.order},{data:u}=await _.put(`/services/${n.id}`,c);Object.assign(n,u)}));const{normalized:s}=B(i.value);i.value=s,t||b("Urutan layanan diperbarui.")}catch(s){console.error(s),b("Gagal memperbarui urutan.")}finally{d.value=!1}}}function O(){M.push("/admin/layanan/tambah")}function $(e){e&&M.push(`/admin/layanan/${e}/edit`)}async function z(e){if(!(e!=null&&e.id)){i.value=i.value.filter(t=>t!==e),C(i.value),b("Layanan dihapus dari daftar sementara.");return}confirm(`Hapus layanan "${e.title||"tanpa judul"}"?`)&&(await _.delete(`/services/${e.id}`),await h(),b("Layanan berhasil dihapus."))}function G(e,t){d.value||(m.value=e,f.value=e,t.dataTransfer.effectAllowed="move")}function N(e,t){d.value||(e.preventDefault(),f.value=t)}function I(e){f.value===e&&(f.value=null)}async function F(e,t){if(e.preventDefault(),d.value){w();return}const r=m.value,s=t;w(),!(r===null||s===null||r===s)&&await L(r,s)}function w(){m.value=null,f.value=null}return P(h),(e,t)=>(o(),l("div",J,[a("header",{class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},[t[2]||(t[2]=a("div",{class:"space-y-1.5"},[a("p",{class:"text-xs font-semibold uppercase tracking-[0.35em] text-primary/70"},"Pelayanan Desa"),a("h1",{class:"text-3xl font-semibold text-slate-900"},"Layanan Desa"),a("p",{class:"text-sm text-slate-500"},"Kelola katalog layanan yang tersedia bagi warga melalui portal desa.")],-1)),a("div",{class:"flex flex-wrap items-center gap-3"},[a("button",{type:"button",class:"inline-flex items-center gap-2 rounded-full bg-primary px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-primary/90",onClick:O},[...t[0]||(t[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 6v12m6-6H6"})],-1),k(" Tambah Layanan ",-1)])]),a("button",{type:"button",class:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-primary hover:text-primary",onClick:h},[...t[1]||(t[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4.5 4.5v6h6M19.5 19.5v-6h-6M5.876 18.124A8.25 8.25 0 0 1 18.124 5.876"})],-1),k(" Muat ulang ",-1)])])])]),a("section",Q,[t[6]||(t[6]=a("div",{class:"flex flex-wrap items-center justify-between gap-4 border-b border-slate-100 pb-4"},[a("div",null,[a("h2",{class:"text-lg font-semibold text-slate-900"},"Daftar Layanan"),a("p",{class:"text-xs text-slate-500"},"Ringkasan layanan aktif yang tampil untuk masyarakat.")])],-1)),x.value?(o(),l("div",W,[...t[3]||(t[3]=[a("div",{class:"h-10 w-10 animate-spin rounded-full border-4 border-primary/30 border-t-primary"},null,-1)])])):(o(),l(E,{key:1},[a("div",Y,[d.value?(o(),l("span",Z,"Menyimpan urutan...")):v.value?(o(),l("span",ee,p(v.value),1)):(o(),l("span",te,"Â "))]),T.value.length?(o(),l("div",ae,[(o(!0),l(E,null,X(T.value,(r,s)=>(o(),l("article",{key:r.id||r.title||s,class:K(["flex h-full flex-col justify-between rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition",[d.value?"cursor-not-allowed opacity-60":"cursor-grab hover:-translate-y-0.5 hover:shadow-lg",m.value===s?"ring-2 ring-primary/40 border-primary/50":"",f.value===s&&m.value!==null&&m.value!==s?"border-primary/30":""]]),draggable:!d.value,onDragstart:n=>G(s,n),onDragover:D(n=>N(n,s),["prevent"]),onDragenter:D(n=>N(n,s),["prevent"]),onDragleave:n=>I(s),onDrop:D(n=>F(n,s),["prevent"]),onDragend:w,title:"Geser Untuk Mengurutkan"},[a("div",ne,[a("div",se,[a("span",oe," Urutan: "+p(r.order??0),1),t[4]||(t[4]=a("span",{class:"flex items-center gap-1 rounded-full border border-dashed border-primary/40 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.3em] text-primary/70"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 8h16M4 12h16M4 16h16"})]),k(" Geser ")],-1))]),a("p",le,p(A(r.updated_at)),1),a("h3",ie,p(r.title),1),r.subtitle?(o(),l("p",de,p(r.subtitle),1)):q("",!0),a("p",ue,p(r.description||"Belum ada deskripsi rinci layanan."),1)]),a("div",ce,[a("p",pe,p(r.link?"Tautan layanan tersedia":"Tidak ada tautan"),1),a("div",me,[a("button",{type:"button",class:"text-primary hover:text-primary/80",onClick:n=>$(r.id)},"Ubah",8,fe),a("button",{type:"button",class:"text-rose-500 hover:text-rose-400",onClick:n=>z(r)},"Hapus",8,ge)])])],42,re))),128))])):(o(),l("div",ye,[...t[5]||(t[5]=[a("p",{class:"text-sm font-semibold text-slate-600"},"Belum ada layanan desa yang terdaftar.",-1),a("p",{class:"mt-2 text-xs text-slate-400"},'Gunakan tombol "Tambah Layanan" untuk membuat data baru.',-1)])]))],64))])]))}};export{he as default};
