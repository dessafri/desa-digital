import{_ as B,g as E,f as x,o as G,a as i,b as d,d as a,F as I,r as M,e as w,y as h,k as c,p as z,n as _,w as y,v as f,t as A}from"./app-0010789c.js";import{n as r}from"./notify-9318a045.js";const H={class:"p-8"},J={class:"mt-8 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},K={key:0,class:"grid place-items-center py-16"},L={key:1,class:"space-y-4"},q=["onDragstart","onDragenter","onDrop"],Q={class:"grid gap-4 md:grid-cols-3 text-xs font-semibold text-slate-500"},R={class:"space-y-1"},W=["onUpdate:modelValue"],X={class:"space-y-1"},Y=["onUpdate:modelValue"],Z={class:"space-y-2"},ee={class:"flex flex-col items-start gap-2"},te={class:"h-[100px] w-[100px] min-w-[100px] overflow-hidden rounded-md border bg-white shrink-0"},se=["src","onClick"],ae=["onChange"],ne={class:"space-y-1"},oe=["onUpdate:modelValue"],le={class:"space-y-1 md:col-span-2"},re=["onUpdate:modelValue"],ie={class:"mt-3 flex justify-between text-xs font-semibold"},de={class:"text-slate-400"},ue={class:"space-x-3"},pe=["onClick"],ce=["onClick"],me={key:0,class:"text-center text-xs text-slate-400"},ge={class:"max-h-[90vh] max-w-5xl overflow-auto rounded-xl bg-white p-3"},ve=["src"],xe={__name:"AdminOfficialView",setup(he){const o=E([]),b=x(!1),u=x(null),m=x(null),g=x("");function D(e){return`${e.id??"new"}-${Math.random().toString(36).slice(2,9)}`}function v(e={}){return{_key:D(e),id:e.id??null,name:e.name??"",position:e.position??"",photo:e.photo??"",phone:e.phone??"",email:e.email??"",order:Number(e.order??0)}}async function C(){b.value=!0;try{const{data:e}=await c.get("/village-officials");o.splice(0,o.length,...e.map(v))}finally{b.value=!1}}function V(){o.unshift(v())}async function O(e){try{const t={name:e.name,position:e.position,photo:e.photo||null,phone:e.phone||null,email:e.email||null};if(e.id){const{data:s}=await c.put(`/village-officials/${e.id}`,t);Object.assign(e,v(s)),r.success("Perangkat Desa diperbarui")}else{const{data:s}=await c.post("/village-officials",t);Object.assign(e,v(s)),r.success("Perangkat Desa ditambahkan")}}catch(t){console.error(t),r.error("Gagal menyimpan perangkat")}}async function $(e){if(e.id){if(!confirm(`Hapus ${e.name||"perangkat desa"}?`))return;try{await c.delete(`/village-officials/${e.id}`),r.success("Perangkat Desa dihapus")}catch(s){console.error(s),r.error("Gagal menghapus perangkat");return}}const t=o.findIndex(s=>s._key===e._key);t!==-1&&o.splice(t,1)}G(C);async function U(e,t){var n;const s=(n=t.target.files)==null?void 0:n[0];if(!s)return;const l=new FormData;l.append("file",s);try{const{data:p}=await c.post("/village-officials/upload-photo",l,{headers:{"Content-Type":"multipart/form-data"}});p!=null&&p.url&&(e.photo=p.url,r.success("Foto terunggah"))}catch(p){console.error(p),r.error("Upload foto gagal")}finally{t.target.value=""}}function P(e){u.value=e}function T(e){u.value!==null&&(m.value=e)}async function j(e){if(u.value===null)return;const t=u.value,s=e;if(t!==s){const[l]=o.splice(t,1);o.splice(s,0,l),await N()}u.value=null,m.value=null}function F(){u.value=null,m.value=null}async function N(){try{const e=o.filter(t=>t.id).map((t,s)=>c.put(`/village-officials/${t.id}`,{order:s}));e.length&&(await Promise.all(e),r.success("Urutan tersimpan"))}catch(e){console.error("Gagal menyimpan urutan perangkat desa:",e),r.error("Gagal menyimpan urutan")}}function S(e){g.value=e}function k(){g.value=""}return(e,t)=>(i(),d("div",H,[a("header",{class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},[t[1]||(t[1]=a("div",null,[a("h1",{class:"text-2xl font-semibold text-slate-900"},"Perangkat Desa"),a("p",{class:"text-sm text-slate-500"},"Kelola daftar perangkat desa yang tampil pada halaman profil.")],-1)),a("button",{class:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white",onClick:V}," Tambah Perangkat ")]),a("section",J,[b.value?(i(),d("div",K,[...t[2]||(t[2]=[a("div",{class:"h-10 w-10 animate-spin rounded-full border-4 border-primary/30 border-t-primary"},null,-1)])])):(i(),d("div",L,[t[8]||(t[8]=a("p",{class:"text-xs text-slate-400"},"Seret kartu untuk mengubah urutan",-1)),(i(!0),d(I,null,M(o,(s,l)=>(i(),d("article",{key:s._key,class:z(["rounded-xl border border-slate-100 bg-slate-50 p-4 transition",l===m.value?"ring-2 ring-primary/40":""]),draggable:"true",onDragstart:n=>P(l),onDragenter:h(n=>T(l),["prevent"]),onDragover:t[0]||(t[0]=h(()=>{},["prevent"])),onDrop:h(n=>j(l),["prevent"]),onDragend:F},[a("div",Q,[a("label",R,[t[3]||(t[3]=_(" Nama ",-1)),y(a("input",{"onUpdate:modelValue":n=>s.name=n,type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},null,8,W),[[f,s.name]])]),a("label",X,[t[4]||(t[4]=_(" Jabatan ",-1)),y(a("input",{"onUpdate:modelValue":n=>s.position=n,type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},null,8,Y),[[f,s.position]])]),a("div",Z,[t[5]||(t[5]=a("span",null,"Foto",-1)),a("div",ee,[a("div",te,[s.photo?(i(),d("img",{key:0,src:s.photo,alt:"foto",class:"h-full w-full object-cover cursor-zoom-in",onClick:n=>S(s.photo)},null,8,se)):w("",!0)]),a("input",{type:"file",accept:"image/*",onChange:n=>U(s,n),class:"text-xs"},null,40,ae)])]),a("label",ne,[t[6]||(t[6]=_(" Telepon ",-1)),y(a("input",{"onUpdate:modelValue":n=>s.phone=n,type:"text",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},null,8,oe),[[f,s.phone]])]),a("label",le,[t[7]||(t[7]=_(" Email ",-1)),y(a("input",{"onUpdate:modelValue":n=>s.email=n,type:"email",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"},null,8,re),[[f,s.email]])])]),a("div",ie,[a("span",de,A(s.id?"Data tersimpan":"Data baru"),1),a("div",ue,[a("button",{class:"text-primary",onClick:n=>O(s)},"Simpan",8,pe),a("button",{class:"text-rose-500",onClick:n=>$(s)},"Hapus",8,ce)])])],42,q))),128)),o.length?w("",!0):(i(),d("p",me,"Belum ada perangkat desa terdaftar."))]))]),g.value?(i(),d("div",{key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/70 p-4",onClick:h(k,["self"])},[a("div",ge,[a("img",{src:g.value,alt:"Preview",class:"h-auto w-full"},null,8,ve),a("div",{class:"mt-3 text-right"},[a("button",{class:"rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white",onClick:k},"Tutup")])])])):w("",!0)]))}},fe=B(xe,[["__scopeId","data-v-204d910b"]]);export{fe as default};
